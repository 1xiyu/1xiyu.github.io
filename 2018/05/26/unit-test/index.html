<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="litchi"><link rel="alternative" href="/atom.xml" title="fe ? not exsit ?" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>初探前端单元测试 - fe ? not exsit ?</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">fe ? not exsit ?</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-05-26T11:35:22.132Z">May 26, 2018</time><h1 class="post__title"><a href="/2018/05/26/unit-test/">初探前端单元测试</a></h1><div class="post__main echo"><p>俗话说：不怕贼偷，就怕贼惦记。So，我惦记了测试良久，也该入手了。简单说一下，测试深感是一项开发的必备能力，这个整的太不接地气了，其实就是让你在开发的时候更快的知道一些漏洞和学习一些其他人代码时候做的测试帮助你了解。最通俗的举个例子，一个project，A模块很多复杂代码逻辑，小明开始入手一个迭代需求，开开心心的开发提测，突然接收到了qa爸爸妈妈的制裁，- -大家都懂得。这个时候单元测试的作用就出来了，可以迅速的提示你写的代码对之前需求有无影响。。个人的粗陋见解。Dont bb, up up up。（附：感谢一下杨w文坚哥哥的指引方向吧！）</p>
<h2 id="Assert"><a href="#Assert" class="headerlink" title="Assert"></a>Assert</h2><p>assert 是Node的一个关于做断言测试的内置模块。大体就是一个类的一些成员方法提供参数做一些是否符合预期的判断，不符合就会由AssertionError抛出错误，符合就会pass。如果你想自定义ErrorMessage也有对应的format方法。</p>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * assert</span><br><span class="line"> */</span><br><span class="line">const sum = (a, b) =&gt; a + b;</span><br><span class="line">let expected = sum(1,2);</span><br><span class="line">assert( expected === 4, &apos;expected value is not right&apos;);</span><br><span class="line">// output: AssertionError [ERR_ASSERTION]: expected value is not right</span><br><span class="line">//     assert( expected === 3, &apos;expected value is not right&apos;);</span><br><span class="line">//if that will pass</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * equal</span><br><span class="line"> */</span><br><span class="line"> assert.equal(1,2);</span><br><span class="line">AssertionError [ERR_ASSERTION]: 1 == 2</span><br></pre></td></tr></table></figure>
<h2 id="mocha"><a href="#mocha" class="headerlink" title="mocha"></a>mocha</h2><p>比较知名的基于nodejs的前端测试框架，以灵活方便有趣著称，首先看一下测试脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var assert = require(&apos;assert&apos;);</span><br><span class="line">describe(&apos;Array&apos;, function() &#123;</span><br><span class="line">describe(&apos;#indexOf()&apos;, function() &#123;</span><br><span class="line">    it(&apos;should return -1 when the value is not present&apos;, function() &#123;</span><br><span class="line">    assert.equal([1,2,3].indexOf(4), -1);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如官网所言灵活方便有趣，测试的编写过程：describe 测试套件 + it 测试用例 + 断言库（目前用的node的assert模块）<br>提到断言库可以搭配很多库。比较主流的像偏语义化的shouldjs和chaijs。势利眼看star高的就看好chai。</p>
<p>再简单看一下重点异步测试和hook</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe(&apos;async test&apos;, function() &#123;</span><br><span class="line">    var foo  = false;</span><br><span class="line">    //hook</span><br><span class="line">    beforeEach(function() &#123;</span><br><span class="line">        foo = true;</span><br><span class="line">    &#125;);</span><br><span class="line">    // async</span><br><span class="line">    it(&apos;返回成功&apos;, function(done)&#123;</span><br><span class="line">        fetch(&apos;https://news-at.zhihu.com/api/4/news/latest&apos;).then(function(err, res)&#123;</span><br><span class="line">            assert(typeOf(res) == &apos;object&apos;, &apos;返回类型是Object&apos;);</span><br><span class="line">            assert(foo, &apos;foo应该是true&apos;);</span><br><span class="line">            done();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 学习的时候遇到的一个小坑 –growl 参数在os系统桌面弹窗提醒，前提是os系统预先装好了Growl，这点<br>在mocha issue里也说明了。。</p>
</blockquote>
<h2 id="karma"><a href="#karma" class="headerlink" title="karma"></a>karma</h2><p>首先明确概念，非断言库非测试框架。是angularjs团队打造，旨在给开发者创建一个开发测试环境，通过配置一些loader给予一些feedback。同样的，先跑个例子为敬。</p>
<ol>
<li>npm init 一个npm环境</li>
<li><p>写一个测试用例hello.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">describe(&apos;A spec suite&apos;, function() &#123;</span><br><span class="line">    it(&apos;contains a passing spec&apos;, function() &#123;</span><br><span class="line">        console.log(&quot;Hello Karam&quot;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>karma init   option依次为mocha、no nedd requireJs、Chrome、*.js、yes,再检查一下自己package.json里面的文件</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;0526&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;karma&quot;: &quot;^2.0.2&quot;,</span><br><span class="line">    &quot;karma-chrome-launcher&quot;: &quot;^2.2.0&quot;,</span><br><span class="line">    &quot;karma-mocha&quot;: &quot;^1.3.0&quot;,</span><br><span class="line">    &quot;mocha&quot;: &quot;^5.2.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>至此一个karma + mocha的实例就ok了。</li>
</ol>
<blockquote>
<p>这里有一个隐蔽的小坑，在全局安装了karma之后node执行karma的时候始终会报一个 Error: No provider for “framework:mocha”! 类型的错误，造成这个问题的原因是我在全局安装了karma，之后在stackoverflow上观察大神操作全局装karma-cli就ok了。。</p>
</blockquote>
<h2 id="travis-ci"><a href="#travis-ci" class="headerlink" title="travis-ci"></a>travis-ci</h2><p>这也是本人入门的第一个持续集成的学习，该ci提供一个运行环境用于测试、构建、部署等。好处的话就是足够方便、定制化提供集成的服务方向。</p>
<ol>
<li>首先登录travis-ci, 设置自己github与之关联的仓库文件，这里我把如上karma的代码仓库叫做travis-test</li>
<li><p>然后载在如上travis-test新建一个travis.yml的配置模版</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">language: node_js</span><br><span class="line">node_js:</span><br><span class="line"> - &quot;node&quot;</span><br><span class="line">sudo: required</span><br><span class="line">addons:</span><br><span class="line">  chrome: stable</span><br></pre></td></tr></table></figure>
</li>
<li><p>travis会根据yaml的该模版执行构建 =》 npm test的命令（travis.yml的默认命令，如需执行其他命令可以用script自定义）</p>
</li>
<li>把travis-test push 到github上，触发travis-ci进行构建</li>
<li>之后去travis的构建页面查看一下日志，如果没有通过请浏览命令行查明具体原因，如果ok则会显示build: passing的徽章标志。</li>
</ol>
<blockquote>
<p>遇到一个chrome-lanuncher一直失败的问题，在travis的隐藏文档中有一条描述，如果你当前vm没有安装browser，可以使用一个沙箱来代替作为此测试得以解决。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>也是这周抽的时间断断续续看了一些，写了几个工具的demo，每周坚持下去吧。</p>
</div></header></article></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 litchi</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>